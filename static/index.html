<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ifarma BE Study Planner</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CSS CUSTOM PROPERTIES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --primary-bg: rgba(99,102,241,0.08);
            --accent: #06b6d4;
            --accent-light: #22d3ee;

            --bg: #f8fafc;
            --bg-subtle: #f1f5f9;
            --surface: #ffffff;
            --surface-hover: #f8fafc;

            --text: #0f172a;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;

            --border: #e2e8f0;
            --border-focus: var(--primary);

            --success: #10b981;
            --success-bg: #ecfdf5;
            --warning: #f59e0b;
            --warning-bg: #fffbeb;
            --error: #ef4444;
            --error-bg: #fef2f2;
            --info: #6366f1;
            --info-bg: #eef2ff;

            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);

            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;

            --font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESET & BASE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font);
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ANIMATED BACKGROUND
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .bg-pattern {
            position: fixed;
            inset: 0;
            z-index: -1;
            overflow: hidden;
        }
        .bg-pattern::before {
            content: '';
            position: absolute;
            width: 600px; height: 600px;
            background: radial-gradient(circle, rgba(99,102,241,0.12) 0%, transparent 70%);
            top: -200px; right: -100px;
            animation: float 20s ease-in-out infinite;
        }
        .bg-pattern::after {
            content: '';
            position: absolute;
            width: 500px; height: 500px;
            background: radial-gradient(circle, rgba(6,182,212,0.1) 0%, transparent 70%);
            bottom: -150px; left: -100px;
            animation: float 25s ease-in-out infinite reverse;
        }
        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.05); }
            66% { transform: translate(-20px, 20px) scale(0.95); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HEADER
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 30%, #818cf8 70%, #06b6d4 100%);
            color: #fff;
            padding: 0;
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5;
        }
        .header-inner {
            position: relative;
            max-width: 1100px;
            margin: 0 auto;
            padding: 32px 32px 28px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .header-icon {
            width: 56px; height: 56px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            flex-shrink: 0;
        }
        .header-text h1 {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            line-height: 1.3;
        }
        .header-text p {
            font-size: 0.9rem;
            opacity: 0.85;
            margin-top: 2px;
            font-weight: 400;
        }
        .header-badge {
            margin-left: auto;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 0.78rem;
            font-weight: 500;
            letter-spacing: 0.02em;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .header-badge .dot {
            width: 8px; height: 8px;
            background: #34d399;
            border-radius: 50%;
            animation: pulse-dot 2s ease-in-out infinite;
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.8); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LAYOUT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 32px 24px 48px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STEPPER (WIZARD PROGRESS)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .stepper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            margin-bottom: 36px;
            padding: 0 20px;
        }
        .step {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            user-select: none;
            transition: var(--transition);
        }
        .step-number {
            width: 36px; height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
            border: 2px solid var(--border);
            color: var(--text-muted);
            background: var(--surface);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }
        .step-label {
            font-size: 0.82rem;
            font-weight: 500;
            color: var(--text-muted);
            transition: color var(--transition);
            white-space: nowrap;
        }
        .step.active .step-number {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
            box-shadow: 0 0 0 4px rgba(99,102,241,0.2);
        }
        .step.active .step-label { color: var(--text); }
        .step.completed .step-number {
            background: var(--success);
            border-color: var(--success);
            color: #fff;
        }
        .step.completed .step-label { color: var(--text-secondary); }
        .step-line {
            flex: 1;
            height: 2px;
            background: var(--border);
            margin: 0 12px;
            transition: background 0.3s ease;
            min-width: 40px;
        }
        .step-line.completed { background: var(--success); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CARD (FORM PANELS)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            padding: 32px;
            margin-bottom: 24px;
            transition: box-shadow var(--transition), transform var(--transition);
        }
        .card:hover {
            box-shadow: var(--shadow-md);
        }

        /* Form Step Panels */
        .form-panel {
            display: none;
            animation: fadeSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .form-panel.active { display: block; }
        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Section Header */
        .section-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 28px;
        }
        .section-icon {
            width: 44px; height: 44px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        .section-icon.drug { background: linear-gradient(135deg, #dbeafe, #ede9fe); }
        .section-icon.stats { background: linear-gradient(135deg, #fce7f3, #fae8ff); }
        .section-icon.population { background: linear-gradient(135deg, #d1fae5, #cffafe); }
        .section-title h2 {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--text);
            letter-spacing: -0.01em;
        }
        .section-title p {
            font-size: 0.83rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FORM ELEMENTS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px 24px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        .form-label {
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            letter-spacing: 0.01em;
        }
        .form-label .required {
            color: var(--error);
            font-weight: 700;
        }
        .form-label .optional {
            font-weight: 400;
            font-size: 0.75rem;
            color: var(--text-muted);
            background: var(--bg-subtle);
            padding: 1px 8px;
            border-radius: 4px;
        }
        .form-hint {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
            line-height: 1.4;
        }

        /* Input / Select */
        .form-input, .form-select {
            width: 100%;
            padding: 11px 14px;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.92rem;
            font-family: var(--font);
            background: var(--surface);
            color: var(--text);
            transition: all var(--transition);
            appearance: none;
            -webkit-appearance: none;
        }
        .form-input::placeholder {
            color: var(--text-muted);
            font-weight: 400;
        }
        .form-input:hover, .form-select:hover {
            border-color: #cbd5e1;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99,102,241,0.12);
        }
        .form-input.error { border-color: var(--error); }
        .form-input.error:focus { box-shadow: 0 0 0 3px rgba(239,68,68,0.12); }

        /* Custom select arrow */
        .select-wrap {
            position: relative;
        }
        .select-wrap::after {
            content: '';
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            width: 0; height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid var(--text-muted);
            pointer-events: none;
        }
        .form-select {
            padding-right: 36px;
            cursor: pointer;
        }
        input[type="number"] { -moz-appearance: textfield; }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        /* Toggle (checkbox replacement) */
        .toggle-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: var(--bg-subtle);
            border-radius: var(--radius-sm);
            border: 1.5px solid transparent;
            cursor: pointer;
            transition: all var(--transition);
        }
        .toggle-group:hover { border-color: var(--border); background: var(--surface); }
        .toggle-track {
            width: 44px; height: 24px;
            background: #cbd5e1;
            border-radius: 12px;
            position: relative;
            transition: background 0.3s ease;
            flex-shrink: 0;
        }
        .toggle-track::after {
            content: '';
            position: absolute;
            width: 18px; height: 18px;
            background: #fff;
            border-radius: 50%;
            top: 3px; left: 3px;
            transition: transform 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .toggle-group input { display: none; }
        .toggle-group input:checked + .toggle-track {
            background: var(--primary);
        }
        .toggle-group input:checked + .toggle-track::after {
            transform: translateX(20px);
        }
        .toggle-label {
            font-size: 0.88rem;
            font-weight: 500;
            color: var(--text);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           NAVIGATION BUTTONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 28px;
            gap: 12px;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: var(--font);
            font-size: 0.92rem;
            font-weight: 600;
            padding: 12px 28px;
            border-radius: var(--radius-sm);
            border: none;
            cursor: pointer;
            transition: all var(--transition);
            text-decoration: none;
            white-space: nowrap;
        }
        .btn-secondary {
            background: var(--surface);
            color: var(--text-secondary);
            border: 1.5px solid var(--border);
        }
        .btn-secondary:hover {
            background: var(--bg-subtle);
            border-color: #cbd5e1;
            color: var(--text);
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: #fff;
            box-shadow: 0 2px 8px rgba(99,102,241,0.3);
        }
        .btn-primary:hover {
            box-shadow: 0 4px 16px rgba(99,102,241,0.4);
            transform: translateY(-1px);
        }
        .btn-primary:active { transform: translateY(0) scale(0.98); }
        .btn-primary:disabled {
            background: #94a3b8;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }
        .btn-submit {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #fff;
            padding: 14px 40px;
            font-size: 1rem;
            border-radius: var(--radius);
            box-shadow: 0 2px 12px rgba(16,185,129,0.3);
        }
        .btn-submit:hover {
            box-shadow: 0 6px 24px rgba(16,185,129,0.4);
            transform: translateY(-2px);
        }
        .btn-submit:active { transform: translateY(0) scale(0.98); }
        .btn-submit:disabled {
            background: #94a3b8;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }
        .btn-icon {
            font-size: 1.1rem;
            line-height: 1;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SPINNER
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .spinner {
            display: none;
            width: 20px; height: 20px;
            border: 2.5px solid rgba(255,255,255,0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESULTS SECTION
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #results { display: none; }
        #results.visible {
            display: block;
            animation: fadeSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .results-header {
            text-align: center;
            margin-bottom: 32px;
        }
        .results-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            letter-spacing: -0.02em;
        }
        .results-header p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Summary Strip */
        .summary-strip {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 28px;
        }
        .summary-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            transition: all var(--transition);
        }
        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .summary-card .sc-icon { font-size: 1.6rem; margin-bottom: 8px; }
        .summary-card .sc-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text);
            line-height: 1.2;
        }
        .summary-card .sc-label {
            font-size: 0.78rem;
            color: var(--text-muted);
            margin-top: 4px;
            font-weight: 500;
        }

        /* Result Card */
        .result-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
            overflow: hidden;
            transition: all var(--transition);
        }
        .result-card:hover { box-shadow: var(--shadow-md); }
        .result-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px 24px;
            background: var(--bg-subtle);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
        }
        .result-card-header .rc-icon {
            width: 36px; height: 36px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        .rc-icon.pk { background: linear-gradient(135deg, #dbeafe, #e0e7ff); }
        .rc-icon.design { background: linear-gradient(135deg, #fce7f3, #ede9fe); }
        .rc-icon.sample { background: linear-gradient(135deg, #d1fae5, #cffafe); }
        .rc-icon.issues { background: linear-gradient(135deg, #fef3c7, #fce7f3); }
        .rc-icon.synopsis { background: linear-gradient(135deg, #e0e7ff, #dbeafe); }
        .result-card-header h3 {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text);
            flex: 1;
        }
        .result-card-header .collapse-icon {
            color: var(--text-muted);
            transition: transform 0.3s ease;
            font-size: 1.2rem;
        }
        .result-card.collapsed .collapse-icon { transform: rotate(-90deg); }
        .result-card-body {
            padding: 20px 24px;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }
        .result-card.collapsed .result-card-body {
            max-height: 0;
            padding: 0 24px;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.88rem;
        }
        .data-table th, .data-table td {
            padding: 10px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .data-table th {
            background: var(--bg-subtle);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }
        .data-table tr:last-child td { border-bottom: none; }
        .data-table tr:hover td { background: var(--bg-subtle); }
        .data-table th:first-child { border-radius: var(--radius-sm) 0 0 0; }
        .data-table th:last-child { border-radius: 0 var(--radius-sm) 0 0; }

        /* Tags / Badges */
        .tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.02em;
        }
        .tag-info { background: var(--info-bg); color: var(--info); }
        .tag-warning { background: var(--warning-bg); color: #b45309; }
        .tag-error { background: var(--error-bg); color: var(--error); }
        .tag-success { background: var(--success-bg); color: #047857; }

        /* Issue Items */
        .issue-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 16px;
            margin-bottom: 10px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            font-size: 0.88rem;
            line-height: 1.5;
            transition: all var(--transition);
        }
        .issue-item:last-child { margin-bottom: 0; }
        .issue-item:hover { box-shadow: var(--shadow-sm); }
        .issue-item.info { background: var(--info-bg); border-color: rgba(99,102,241,0.2); }
        .issue-item.warning { background: var(--warning-bg); border-color: rgba(245,158,11,0.2); }
        .issue-item.error { background: var(--error-bg); border-color: rgba(239,68,68,0.2); }
        .issue-text strong { font-weight: 600; }
        .no-issues {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--success);
            font-weight: 600;
            font-size: 0.92rem;
            padding: 12px 0;
        }

        /* Synopsis Box */
        .synopsis-box {
            background: var(--bg-subtle);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            font-size: 0.87rem;
            line-height: 1.8;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Inter', system-ui, sans-serif;
        }
        .synopsis-box::-webkit-scrollbar { width: 6px; }
        .synopsis-box::-webkit-scrollbar-track { background: transparent; }
        .synopsis-box::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

        /* Error Box */
        .error-box {
            background: var(--error-bg);
            border: 1px solid rgba(239,68,68,0.3);
            border-radius: var(--radius);
            padding: 16px 20px;
            color: var(--error);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .error-box .err-icon { font-size: 1.2rem; flex-shrink: 0; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FOOTER
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .footer {
            text-align: center;
            padding: 24px;
            color: var(--text-muted);
            font-size: 0.8rem;
            border-top: 1px solid var(--border);
            margin-top: 40px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESPONSIVE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (max-width: 768px) {
            .header-inner { flex-wrap: wrap; padding: 24px 20px; }
            .header-badge { margin-left: 0; margin-top: 8px; width: 100%; justify-content: center; }
            .container { padding: 20px 16px 40px; }
            .card { padding: 24px 20px; }
            .form-grid { grid-template-columns: 1fr; }
            .stepper { flex-wrap: wrap; gap: 8px; justify-content: center; }
            .step-line { display: none; }
            .step { gap: 6px; }
            .step-label { font-size: 0.75rem; }
            .summary-strip { grid-template-columns: repeat(2, 1fr); }
            .nav-buttons { flex-wrap: wrap; }
            .btn { flex: 1; min-width: 120px; }
            .result-card-body { padding: 16px; }
            .result-card-header { padding: 14px 16px; }
        }

        @media (max-width: 480px) {
            .header-text h1 { font-size: 1.2rem; }
            .summary-strip { grid-template-columns: 1fr 1fr; }
            .step-number { width: 32px; height: 32px; font-size: 0.8rem; }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           QUICK-FILL / DRUG SUGGESTIONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .quick-fill {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        .quick-fill-label {
            font-size: 0.78rem;
            color: var(--text-muted);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-right: 4px;
        }
        .quick-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 5px 12px;
            border-radius: 20px;
            border: 1px solid var(--border);
            background: var(--surface);
            font-size: 0.78rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition);
            font-family: var(--font);
        }
        .quick-chip:hover {
            background: var(--primary-bg);
            border-color: var(--primary-light);
            color: var(--primary);
        }
        .quick-chip.active {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RANGE SLIDER (for age/BMI)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .range-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .range-row .form-input {
            width: 80px;
            text-align: center;
            flex-shrink: 0;
        }
        .range-separator {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PILL SELECTOR (radio replacement)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .pill-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 9px 18px;
            border-radius: 24px;
            border: 1.5px solid var(--border);
            background: var(--surface);
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition);
            user-select: none;
            font-family: var(--font);
        }
        .pill:hover { border-color: var(--primary-light); color: var(--text); }
        .pill input { display: none; }
        .pill.active {
            background: var(--primary-bg);
            border-color: var(--primary);
            color: var(--primary-dark);
            font-weight: 600;
        }
        .pill .pill-icon { font-size: 1rem; }
    </style>
</head>
<body>

<div class="bg-pattern"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header class="header">
    <div class="header-inner">
        <div class="header-icon">ğŸ’Š</div>
        <div class="header-text">
            <h1>Ifarma BE Study Planner</h1>
            <p>ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ±Ğ¸Ğ¾ÑĞºĞ²Ğ¸Ğ²Ğ°Ğ»ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸</p>
        </div>
        <div class="header-badge">
            <span class="dot"></span>
            ĞŸÑ€Ğ¾Ñ‚Ğ¾Ñ‚Ğ¸Ğ¿ v0.1
        </div>
    </div>
</header>

<div class="container">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STEPPER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="stepper" id="stepper">
        <div class="step active" data-step="1" onclick="goToStep(1)">
            <div class="step-number">1</div>
            <span class="step-label">ĞŸÑ€ĞµĞ¿Ğ°Ñ€Ğ°Ñ‚</span>
        </div>
        <div class="step-line" id="line1"></div>
        <div class="step" data-step="2" onclick="goToStep(2)">
            <div class="step-number">2</div>
            <span class="step-label">Ğ”Ğ¸Ğ·Ğ°Ğ¹Ğ½</span>
        </div>
        <div class="step-line" id="line2"></div>
        <div class="step" data-step="3" onclick="goToStep(3)">
            <div class="step-number">3</div>
            <span class="step-label">ĞŸĞ¾Ğ¿ÑƒĞ»ÑÑ†Ğ¸Ñ</span>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <form id="studyForm" novalidate>

        <!-- â”€â”€ STEP 1: Drug Info â”€â”€ -->
        <div class="form-panel active" id="panel1">
            <div class="card">
                <div class="section-header">
                    <div class="section-icon drug">ğŸ§ª</div>
                    <div class="section-title">
                        <h2>Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ñ€ĞµĞ¿Ğ°Ñ€Ğ°Ñ‚Ğµ</h2>
                        <p>Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¸ÑÑĞ»ĞµĞ´ÑƒĞµĞ¼Ğ¾Ğ³Ğ¾ Ğ¿Ñ€ĞµĞ¿Ğ°Ñ€Ğ°Ñ‚Ğ°</p>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            ĞœĞĞ (INN) Ğ´ĞµĞ¹ÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ²ĞµÑ‰ĞµÑÑ‚Ğ²Ğ°
                            <span class="required">*</span>
                        </label>
                        <input type="text" id="inn" name="inn" required
                               class="form-input" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞœĞĞ, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ¾Ğ¼ĞµĞ¿Ñ€Ğ°Ğ·Ğ¾Ğ»" autocomplete="off">
                        <div class="quick-fill" id="drugSuggestions">
                            <span class="quick-fill-label">âš¡ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€:</span>
                            <button type="button" class="quick-chip" onclick="selectDrug('Ğ¾Ğ¼ĞµĞ¿Ñ€Ğ°Ğ·Ğ¾Ğ»', 20, 'capsule')">ĞĞ¼ĞµĞ¿Ñ€Ğ°Ğ·Ğ¾Ğ»</button>
                            <button type="button" class="quick-chip" onclick="selectDrug('Ğ¼ĞµÑ‚Ğ¾Ğ¿Ñ€Ğ¾Ğ»Ğ¾Ğ»', 50, 'tablet')">ĞœĞµÑ‚Ğ¾Ğ¿Ñ€Ğ¾Ğ»Ğ¾Ğ»</button>
                            <button type="button" class="quick-chip" onclick="selectDrug('Ğ°Ğ¼Ğ¾ĞºÑĞ¸Ñ†Ğ¸Ğ»Ğ»Ğ¸Ğ½', 500, 'capsule')">ĞĞ¼Ğ¾ĞºÑĞ¸Ñ†Ğ¸Ğ»Ğ»Ğ¸Ğ½</button>
                            <button type="button" class="quick-chip" onclick="selectDrug('Ğ°Ñ‚Ğ¾Ñ€Ğ²Ğ°ÑÑ‚Ğ°Ñ‚Ğ¸Ğ½', 20, 'tablet')">ĞÑ‚Ğ¾Ñ€Ğ²Ğ°ÑÑ‚Ğ°Ñ‚Ğ¸Ğ½</button>
                            <button type="button" class="quick-chip" onclick="selectDrug('Ğ´Ğ¸ĞºĞ»Ğ¾Ñ„ĞµĞ½Ğ°Ğº', 50, 'tablet')">Ğ”Ğ¸ĞºĞ»Ğ¾Ñ„ĞµĞ½Ğ°Ğº</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            Ğ”Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°, Ğ¼Ğ³
                            <span class="required">*</span>
                        </label>
                        <input type="number" id="dose_mg" name="dose_mg" required
                               class="form-input" min="0.01" step="any" placeholder="20">
                        <div class="form-hint">Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ´Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²ĞºÑƒ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ² Ğ¼Ğ¸Ğ»Ğ»Ğ¸Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ…</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ğ›ĞµĞºĞ°Ñ€ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°</label>
                        <div class="pill-group" id="formPills">
                            <label class="pill active" onclick="selectPill(this, 'formPills', 'form')">
                                <input type="radio" name="form_radio" value="tablet" checked>
                                <span class="pill-icon">ğŸ’Š</span> Ğ¢Ğ°Ğ±Ğ»ĞµÑ‚ĞºĞ°
                            </label>
                            <label class="pill" onclick="selectPill(this, 'formPills', 'form')">
                                <input type="radio" name="form_radio" value="capsule">
                                <span class="pill-icon">ğŸ’</span> ĞšĞ°Ğ¿ÑÑƒĞ»Ğ°
                            </label>
                            <label class="pill" onclick="selectPill(this, 'formPills', 'form')">
                                <input type="radio" name="form_radio" value="solution">
                                <span class="pill-icon">ğŸ§´</span> Ğ Ğ°ÑÑ‚Ğ²Ğ¾Ñ€
                            </label>
                            <label class="pill" onclick="selectPill(this, 'formPills', 'form')">
                                <input type="radio" name="form_radio" value="other">
                                <span class="pill-icon">ğŸ“¦</span> Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ
                            </label>
                        </div>
                        <!-- Hidden select for payload -->
                        <select id="form" name="form" style="display:none">
                            <option value="tablet" selected>Ğ¢Ğ°Ğ±Ğ»ĞµÑ‚ĞºĞ°</option>
                            <option value="capsule">ĞšĞ°Ğ¿ÑÑƒĞ»Ğ°</option>
                            <option value="solution">Ğ Ğ°ÑÑ‚Ğ²Ğ¾Ñ€</option>
                            <option value="other">Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°</label>
                        <div class="pill-group" id="regimePills">
                            <label class="pill active" onclick="selectPill(this, 'regimePills', 'regime')">
                                <input type="radio" name="regime_radio" value="fasted" checked>
                                <span class="pill-icon">ğŸ½ï¸</span> ĞĞ°Ñ‚Ğ¾Ñ‰Ğ°Ğº
                            </label>
                            <label class="pill" onclick="selectPill(this, 'regimePills', 'regime')">
                                <input type="radio" name="regime_radio" value="fed">
                                <span class="pill-icon">ğŸ¥—</span> ĞŸĞ¾ÑĞ»Ğµ ĞµĞ´Ñ‹
                            </label>
                            <label class="pill" onclick="selectPill(this, 'regimePills', 'regime')">
                                <input type="radio" name="regime_radio" value="both">
                                <span class="pill-icon">ğŸ”„</span> ĞĞ±Ğ°
                            </label>
                        </div>
                        <select id="regime" name="regime" style="display:none">
                            <option value="fasted" selected>ĞĞ°Ñ‚Ğ¾Ñ‰Ğ°Ğº</option>
                            <option value="fed">ĞŸĞ¾ÑĞ»Ğµ ĞµĞ´Ñ‹</option>
                            <option value="both">ĞĞ±Ğ°</option>
                        </select>
                    </div>
                </div>

                <div class="nav-buttons">
                    <div></div>
                    <button type="button" class="btn btn-primary" onclick="nextStep()">
                        Ğ”Ğ°Ğ»ĞµĞµ <span class="btn-icon">â†’</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- â”€â”€ STEP 2: Variability & Design â”€â”€ -->
        <div class="form-panel" id="panel2">
            <div class="card">
                <div class="section-header">
                    <div class="section-icon stats">ğŸ“Š</div>
                    <div class="section-title">
                        <h2>Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½</h2>
                        <p>ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½</p>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">
                            CVintra
                            <span class="optional">Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾</span>
                        </label>
                        <input type="number" id="cv_intra" name="cv_intra"
                               class="form-input" min="0" max="1" step="0.01" placeholder="0.25">
                        <div class="form-hint">Ğ’Ğ½ÑƒÑ‚Ñ€Ğ¸ÑÑƒĞ±ÑŠĞµĞºÑ‚Ğ½Ğ°Ñ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ±ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ ĞºĞ°Ğº Ğ´Ğ¾Ğ»Ñ (0â€“1)</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ CVintra
                            <span class="optional">ĞµÑĞ»Ğ¸ Ñ‡Ğ¸ÑĞ»Ğ¾ Ğ½Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¾</span>
                        </label>
                        <div class="select-wrap">
                            <select id="cv_category" name="cv_category" class="form-select">
                                <option value="">â€” Ğ½Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ¾ â€”</option>
                                <option value="low">ĞĞ¸Ğ·ĞºĞ°Ñ (low) â€” CV â‰¤ 0.30</option>
                                <option value="high">Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ (high) â€” CV > 0.30</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ğ¢Ğ¸Ğ¿ Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ</label>
                        <div class="pill-group" id="studyTypePills">
                            <label class="pill active" onclick="selectPill(this, 'studyTypePills', 'study_type')">
                                <input type="radio" name="study_type_radio" value="single" checked>
                                ĞĞ´Ğ½Ğ¾Ñ„Ğ°Ğ·Ğ½Ğ¾Ğµ
                            </label>
                            <label class="pill" onclick="selectPill(this, 'studyTypePills', 'study_type')">
                                <input type="radio" name="study_type_radio" value="two_stage">
                                Ğ”Ğ²ÑƒÑ…Ñ„Ğ°Ğ·Ğ½Ğ¾Ğµ (Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ)
                            </label>
                        </div>
                        <select id="study_type" name="study_type" style="display:none">
                            <option value="single" selected>ĞĞ´Ğ½Ğ¾Ñ„Ğ°Ğ·Ğ½Ğ¾Ğµ</option>
                            <option value="two_stage">Ğ”Ğ²ÑƒÑ…Ñ„Ğ°Ğ·Ğ½Ğ¾Ğµ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            ĞŸÑ€ĞµĞ´Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½
                            <span class="optional">Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾</span>
                        </label>
                        <input type="text" id="preferred_design" name="preferred_design"
                               class="form-input" placeholder="Ğ½Ğ°Ğ¿Ñ€. 2x2, 2x3x3">
                        <div class="form-hint">Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ±ĞµÑ€Ñ‘Ñ‚ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½, ĞµÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½</div>
                    </div>
                    <div class="form-group full-width">
                        <label class="toggle-group" id="rsabeToggle">
                            <input type="checkbox" id="need_rsabe" name="need_rsabe">
                            <span class="toggle-track"></span>
                            <span class="toggle-label">ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ RSABE (Reference-Scaled Average Bioequivalence)</span>
                        </label>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button type="button" class="btn btn-secondary" onclick="prevStep()">
                        <span class="btn-icon">â†</span> ĞĞ°Ğ·Ğ°Ğ´
                    </button>
                    <button type="button" class="btn btn-primary" onclick="nextStep()">
                        Ğ”Ğ°Ğ»ĞµĞµ <span class="btn-icon">â†’</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- â”€â”€ STEP 3: Population â”€â”€ -->
        <div class="form-panel" id="panel3">
            <div class="card">
                <div class="section-header">
                    <div class="section-icon population">ğŸ‘¥</div>
                    <div class="section-title">
                        <h2>ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¿Ğ¾Ğ¿ÑƒĞ»ÑÑ†Ğ¸Ğ¸ Ğ´Ğ¾Ğ±Ñ€Ğ¾Ğ²Ğ¾Ğ»ÑŒÑ†ĞµĞ²</h2>
                        <p>ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚Ğµ ĞºÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ±Ñ€Ğ¾Ğ²Ğ¾Ğ»ÑŒÑ†ĞµĞ² Ğ² Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ</p>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ (Ğ»ĞµÑ‚)</label>
                        <div class="range-row">
                            <input type="number" id="min_age" name="min_age"
                                   class="form-input" value="18" min="18" max="65">
                            <span class="range-separator">â€”</span>
                            <input type="number" id="max_age" name="max_age"
                                   class="form-input" value="55" min="18" max="65">
                        </div>
                        <div class="form-hint">ĞÑ‚ 18 Ğ´Ğ¾ 65 Ğ»ĞµÑ‚</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ĞŸĞ¾Ğ» Ğ´Ğ¾Ğ±Ñ€Ğ¾Ğ²Ğ¾Ğ»ÑŒÑ†ĞµĞ²</label>
                        <div class="pill-group" id="sexPills">
                            <label class="pill active" onclick="selectPill(this, 'sexPills', 'sex')">
                                <input type="radio" name="sex_radio" value="both" checked>
                                ğŸ‘« Ğœ Ğ¸ Ğ–
                            </label>
                            <label class="pill" onclick="selectPill(this, 'sexPills', 'sex')">
                                <input type="radio" name="sex_radio" value="male">
                                ğŸ‘¨ ĞœÑƒĞ¶ÑĞºĞ¾Ğ¹
                            </label>
                            <label class="pill" onclick="selectPill(this, 'sexPills', 'sex')">
                                <input type="radio" name="sex_radio" value="female">
                                ğŸ‘© Ğ–ĞµĞ½ÑĞºĞ¸Ğ¹
                            </label>
                        </div>
                        <select id="sex" name="sex" style="display:none">
                            <option value="both" selected>ĞœÑƒĞ¶ÑĞºĞ¾Ğ¹ Ğ¸ Ğ¶ĞµĞ½ÑĞºĞ¸Ğ¹</option>
                            <option value="male">ĞœÑƒĞ¶ÑĞºĞ¾Ğ¹</option>
                            <option value="female">Ğ–ĞµĞ½ÑĞºĞ¸Ğ¹</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ğ˜ĞœĞ¢ (ĞºĞ³/Ğ¼Â²)</label>
                        <div class="range-row">
                            <input type="number" id="bmi_min" name="bmi_min"
                                   class="form-input" value="18.5" min="10" max="50" step="0.1">
                            <span class="range-separator">â€”</span>
                            <input type="number" id="bmi_max" name="bmi_max"
                                   class="form-input" value="30.0" min="10" max="60" step="0.1">
                        </div>
                        <div class="form-hint">Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¼Ğ°ÑÑÑ‹ Ñ‚ĞµĞ»Ğ° (ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚: 18.5â€“30.0)</div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button type="button" class="btn btn-secondary" onclick="prevStep()">
                        <span class="btn-icon">â†</span> ĞĞ°Ğ·Ğ°Ğ´
                    </button>
                    <button type="submit" class="btn btn-submit" id="submitBtn">
                        <span id="btnText">ğŸš€ Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ½ Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ</span>
                        <span class="spinner" id="spinner"></span>
                    </button>
                </div>
            </div>
        </div>
    </form>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESULTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="results">

        <!-- Error -->
        <div id="errorBox" class="error-box" style="display:none;">
            <span class="err-icon">âš ï¸</span>
            <span id="errorText"></span>
        </div>

        <div class="results-header" id="resultsHeader" style="display:none;">
            <h2>ğŸ“‹ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ</h2>
            <p>ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ±Ğ¸Ğ¾ÑĞºĞ²Ğ¸Ğ²Ğ°Ğ»ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸</p>
        </div>

        <!-- Summary Strip -->
        <div class="summary-strip" id="summaryStrip" style="display:none;"></div>

        <!-- PK Parameters -->
        <div class="result-card" id="resPK" style="display:none;">
            <div class="result-card-header" onclick="toggleCard('resPK')">
                <div class="rc-icon pk">ğŸ“ˆ</div>
                <h3>Ğ¤Ğ°Ñ€Ğ¼Ğ°ĞºĞ¾ĞºĞ¸Ğ½ĞµÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹</h3>
                <span class="collapse-icon">â–¾</span>
            </div>
            <div class="result-card-body">
                <table class="data-table">
                    <thead><tr><th>ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€</th><th>Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ</th></tr></thead>
                    <tbody id="pkBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Design -->
        <div class="result-card" id="resDesign" style="display:none;">
            <div class="result-card-header" onclick="toggleCard('resDesign')">
                <div class="rc-icon design">ğŸ”¬</div>
                <h3>Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½ Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ</h3>
                <span class="collapse-icon">â–¾</span>
            </div>
            <div class="result-card-body" id="designDetails"></div>
        </div>

        <!-- Sample Size -->
        <div class="result-card" id="resSample" style="display:none;">
            <div class="result-card-header" onclick="toggleCard('resSample')">
                <div class="rc-icon sample">ğŸ”¢</div>
                <h3>Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ²Ñ‹Ğ±Ğ¾Ñ€ĞºĞ¸</h3>
                <span class="collapse-icon">â–¾</span>
            </div>
            <div class="result-card-body" id="sampleDetails"></div>
        </div>

        <!-- Regulatory Issues -->
        <div class="result-card" id="resIssues" style="display:none;">
            <div class="result-card-header" onclick="toggleCard('resIssues')">
                <div class="rc-icon issues">âš ï¸</div>
                <h3>Ğ ĞµĞ³ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ</h3>
                <span class="collapse-icon">â–¾</span>
            </div>
            <div class="result-card-body" id="issuesList"></div>
        </div>

        <!-- Synopsis -->
        <div class="result-card" id="resSynopsis" style="display:none;">
            <div class="result-card-header" onclick="toggleCard('resSynopsis')">
                <div class="rc-icon synopsis">ğŸ“</div>
                <h3>Ğ¡Ğ¸Ğ½Ğ¾Ğ¿ÑĞ¸Ñ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»Ğ°</h3>
                <span class="collapse-icon">â–¾</span>
            </div>
            <div class="result-card-body">
                <div class="synopsis-box" id="synopsisContent"></div>
            </div>
        </div>
    </div>

</div>

<footer class="footer">
    Ifarma BE Study Planner â€” Ğ¿Ñ€Ğ¾Ñ‚Ğ¾Ñ‚Ğ¸Ğ¿ Ğ´Ğ»Ñ SechenovTech Hackathon
</footer>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIZARD / STEPPER LOGIC
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentStep = 1;
const totalSteps = 3;

function goToStep(step) {
    if (step < 1 || step > totalSteps) return;
    // Validate before moving forward
    if (step > currentStep && !validateCurrentStep()) return;

    currentStep = step;
    updateStepper();
    updatePanels();
}

function nextStep() {
    if (!validateCurrentStep()) return;
    goToStep(currentStep + 1);
}

function prevStep() {
    goToStep(currentStep - 1);
}

function updateStepper() {
    document.querySelectorAll('.step').forEach((s, i) => {
        const stepNum = i + 1;
        s.classList.remove('active', 'completed');
        if (stepNum === currentStep) s.classList.add('active');
        else if (stepNum < currentStep) s.classList.add('completed');
    });
    document.querySelectorAll('.step-line').forEach((l, i) => {
        l.classList.toggle('completed', i + 1 < currentStep);
    });
}

function updatePanels() {
    document.querySelectorAll('.form-panel').forEach((p, i) => {
        p.classList.toggle('active', i + 1 === currentStep);
    });
}

function validateCurrentStep() {
    if (currentStep === 1) {
        const inn = document.getElementById('inn').value.trim();
        const dose = parseFloat(document.getElementById('dose_mg').value);
        const innInput = document.getElementById('inn');
        const doseInput = document.getElementById('dose_mg');

        let valid = true;
        innInput.classList.remove('error');
        doseInput.classList.remove('error');

        if (!inn) {
            innInput.classList.add('error');
            innInput.focus();
            valid = false;
        }
        if (isNaN(dose) || dose <= 0) {
            doseInput.classList.add('error');
            if (valid) doseInput.focus();
            valid = false;
        }
        return valid;
    }
    return true;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PILL SELECTOR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function selectPill(el, groupId, hiddenSelectId) {
    const group = document.getElementById(groupId);
    group.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
    el.classList.add('active');
    const val = el.querySelector('input').value;
    const sel = document.getElementById(hiddenSelectId);
    sel.value = val;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUICK-FILL DRUG SELECTION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function selectDrug(name, dose, form) {
    document.getElementById('inn').value = name;
    document.getElementById('dose_mg').value = dose;
    // Update form pills
    const formSel = document.getElementById('form');
    formSel.value = form;
    document.querySelectorAll('#formPills .pill').forEach(p => {
        const radio = p.querySelector('input');
        p.classList.toggle('active', radio.value === form);
        radio.checked = (radio.value === form);
    });
    // Clear errors
    document.getElementById('inn').classList.remove('error');
    document.getElementById('dose_mg').classList.remove('error');
    // Update chips
    document.querySelectorAll('.quick-chip').forEach(c => {
        c.classList.toggle('active', c.textContent.trim().toLowerCase() === name.toLowerCase());
    });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COLLAPSIBLE RESULT CARDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleCard(id) {
    document.getElementById(id).classList.toggle('collapsed');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM SUBMISSION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('studyForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const btn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');
    const btnText = document.getElementById('btnText');
    const errorBox = document.getElementById('errorBox');
    const errorText = document.getElementById('errorText');

    // Build payload
    const payload = {
        inn: document.getElementById('inn').value.trim(),
        dose_mg: parseFloat(document.getElementById('dose_mg').value),
        form: document.getElementById('form').value,
        regime: document.getElementById('regime').value,
        study_type: document.getElementById('study_type').value,
        min_age: parseInt(document.getElementById('min_age').value, 10),
        max_age: parseInt(document.getElementById('max_age').value, 10),
        sex: document.getElementById('sex').value,
        bmi_min: parseFloat(document.getElementById('bmi_min').value),
        bmi_max: parseFloat(document.getElementById('bmi_max').value),
    };

    // Optional fields
    const cvVal = document.getElementById('cv_intra').value;
    if (cvVal !== '') payload.cv_intra = parseFloat(cvVal);

    const cvCat = document.getElementById('cv_category').value;
    if (cvCat !== '') payload.cv_category = cvCat;

    const prefDesign = document.getElementById('preferred_design').value.trim();
    if (prefDesign !== '') payload.preferred_design = prefDesign;

    if (document.getElementById('need_rsabe').checked) {
        payload.need_rsabe = true;
    }

    // Validate required
    if (!payload.inn || isNaN(payload.dose_mg) || payload.dose_mg <= 0) {
        errorText.textContent = 'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ: ĞœĞĞ Ğ¸ Ğ´Ğ¾Ğ·Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° (> 0).';
        errorBox.style.display = 'flex';
        hideResultCards();
        return;
    }

    // Show spinner
    btn.disabled = true;
    spinner.style.display = 'inline-block';
    btnText.textContent = 'Ğ Ğ°ÑÑ‡Ñ‘Ñ‚â€¦';
    errorBox.style.display = 'none';

    try {
        const resp = await fetch('/design', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
        });

        if (!resp.ok) {
            const err = await resp.json().catch(() => ({}));
            throw new Error(err.detail || 'ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°: ' + resp.status);
        }

        const data = await resp.json();
        renderResults(data, payload);

    } catch (err) {
        errorText.textContent = 'ĞÑˆĞ¸Ğ±ĞºĞ°: ' + err.message;
        errorBox.style.display = 'flex';
        hideResultCards();
    } finally {
        btn.disabled = false;
        spinner.style.display = 'none';
        btnText.textContent = 'ğŸš€ Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ½ Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ';
    }
});

function hideResultCards() {
    const results = document.getElementById('results');
    results.classList.add('visible');
    document.getElementById('resultsHeader').style.display = 'none';
    document.getElementById('summaryStrip').style.display = 'none';
    document.getElementById('resPK').style.display = 'none';
    document.getElementById('resDesign').style.display = 'none';
    document.getElementById('resSample').style.display = 'none';
    document.getElementById('resIssues').style.display = 'none';
    document.getElementById('resSynopsis').style.display = 'none';
}

function renderResults(data, payload) {
    const results = document.getElementById('results');
    results.classList.add('visible');
    document.getElementById('errorBox').style.display = 'none';
    document.getElementById('resultsHeader').style.display = '';
    document.getElementById('summaryStrip').style.display = '';
    document.getElementById('resPK').style.display = '';
    document.getElementById('resDesign').style.display = '';
    document.getElementById('resSample').style.display = '';
    document.getElementById('resIssues').style.display = '';
    document.getElementById('resSynopsis').style.display = '';

    // Remove collapsed state
    document.querySelectorAll('.result-card').forEach(c => c.classList.remove('collapsed'));

    // â”€â”€ Summary strip â”€â”€
    const issueCount = data.issues.length;
    const issueColor = issueCount === 0 ? 'success' : (data.issues.some(i => i.severity === 'error') ? 'error' : 'warning');
    document.getElementById('summaryStrip').innerHTML = [
        { icon: 'ğŸ§ª', value: payload.inn, label: 'ĞŸÑ€ĞµĞ¿Ğ°Ñ€Ğ°Ñ‚' },
        { icon: 'ğŸ”¬', value: data.design.type, label: 'Ğ”Ğ¸Ğ·Ğ°Ğ¹Ğ½' },
        { icon: 'ğŸ‘¥', value: data.sample_size.adjusted_for_dropout, label: 'Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğ²Ğ¾Ğ»ÑŒÑ†ĞµĞ²' },
        { icon: issueCount === 0 ? 'âœ…' : 'âš ï¸', value: issueCount === 0 ? 'ĞĞµÑ‚' : issueCount, label: 'Ğ—Ğ°Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ' },
    ].map(c => `
        <div class="summary-card">
            <div class="sc-icon">${c.icon}</div>
            <div class="sc-value">${c.value}</div>
            <div class="sc-label">${c.label}</div>
        </div>
    `).join('');

    // â”€â”€ PK table â”€â”€
    const pk = data.pk;
    const pkRows = [
        ['Cmax', pk.cmax, 'Ğ½Ğ³/Ğ¼Ğ»'],
        ['AUC', pk.auc, 'Ğ½Ğ³Â·Ñ‡/Ğ¼Ğ»'],
        ['Tmax', pk.tmax, 'Ñ‡'],
        ['TÂ½', pk.t_half, 'Ñ‡'],
        ['CVintra', pk.cv_intra, ''],
    ];
    document.getElementById('pkBody').innerHTML = pkRows.map(([p, v, u]) =>
        '<tr><td><strong>' + p + '</strong>' + (u ? ' <span style="color:var(--text-muted);font-size:0.8rem">(' + u + ')</span>' : '') + '</td>' +
        '<td>' + (v != null ? v : '<span style="color:var(--text-muted)">â€”</span>') + '</td></tr>'
    ).join('');

    // â”€â”€ Design â”€â”€
    const d = data.design;
    document.getElementById('designDetails').innerHTML =
        '<table class="data-table">' +
        '<tr><td><strong>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</strong></td><td>' + d.name + '</td></tr>' +
        '<tr><td><strong>Ğ¢Ğ¸Ğ¿</strong></td><td><span class="tag tag-info">' + d.type + '</span></td></tr>' +
        '<tr><td><strong>ĞŸĞµÑ€Ğ¸Ğ¾Ğ´Ñ‹</strong></td><td>' + d.periods + '</td></tr>' +
        '<tr><td><strong>ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸</strong></td><td>' + d.sequences.map(function(s){ return '<span class="tag tag-info">' + s + '</span>'; }).join(' ') + '</td></tr>' +
        '<tr><td><strong>Wash-out</strong></td><td>' + d.washout_days + ' Ğ´Ğ½ĞµĞ¹</td></tr>' +
        '<tr><td><strong>RSABE</strong></td><td>' + (d.rsabe_applicable
            ? '<span class="tag tag-success">âœ“ Ğ”Ğ°</span>'
            : '<span class="tag" style="background:#f1f5f9;color:var(--text-muted)">ĞĞµÑ‚</span>') + '</td></tr>' +
        '</table>';

    // â”€â”€ Sample size â”€â”€
    const s = data.sample_size;
    document.getElementById('sampleDetails').innerHTML =
        '<table class="data-table">' +
        '<tr><td><strong>Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ N</strong></td><td>' + s.base_n + '</td></tr>' +
        '<tr><td><strong>N Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑŒ</strong></td><td><strong style="color:var(--primary);font-size:1.1rem">' + s.adjusted_for_dropout + '</strong></td></tr>' +
        '<tr><td><strong>Drop-out rate</strong></td><td>' + (s.dropout_rate * 100).toFixed(0) + '%</td></tr>' +
        '<tr><td><strong>Screen-fail rate</strong></td><td>' + (s.screen_fail_rate * 100).toFixed(0) + '%</td></tr>' +
        '</table>';

    // â”€â”€ Issues â”€â”€
    const issuesDiv = document.getElementById('issuesList');
    if (data.issues.length === 0) {
        issuesDiv.innerHTML = '<div class="no-issues">âœ… Ğ ĞµĞ³ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğ¹ Ğ½ĞµÑ‚ â€” Ğ²ÑÑ‘ Ğ² Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ!</div>';
    } else {
        issuesDiv.innerHTML = data.issues.map(function(iss) {
            var icon = iss.severity === 'error' ? 'ğŸ›‘' : (iss.severity === 'warning' ? 'âš ï¸' : 'â„¹ï¸');
            return '<div class="issue-item ' + iss.severity + '">' +
                '<span style="font-size:1.2rem;flex-shrink:0">' + icon + '</span>' +
                '<div class="issue-text"><span class="tag tag-' + iss.severity + '">' + iss.severity.toUpperCase() + '</span> ' +
                '<strong>[' + iss.code + ']</strong> ' + iss.message + '</div></div>';
        }).join('');
    }

    // â”€â”€ Synopsis â”€â”€
    document.getElementById('synopsisContent').textContent = data.synopsis_md;

    // Scroll to results
    results.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INPUT INTERACTION ENHANCEMENTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Clear error state on input
document.querySelectorAll('.form-input').forEach(function(input) {
    input.addEventListener('input', function() {
        this.classList.remove('error');
    });
});

// Keyboard navigation: Enter goes to next step
document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && e.target.tagName !== 'BUTTON' && e.target.tagName !== 'TEXTAREA') {
        if (currentStep < totalSteps) {
            e.preventDefault();
            nextStep();
        }
    }
});
</script>

</body>
</html>
